<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qualitech International - MechNova</title>
    <style>
        /* [Previous CSS styles remain exactly the same] */
    </style>
</head>
<body>
    <!-- [Previous HTML structure remains exactly the same until the script section] -->

    <script>
        // Function to update Egypt date and time
        function updateEgyptDateTime() {
            const options = {
                timeZone: 'Africa/Cairo',
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: true
            };
            
            const now = new Date();
            const egyptDateTime = now.toLocaleString('en-US', options);
            document.getElementById('egyptDateTime').textContent = egyptDateTime;
        }

        // Update immediately and then every second
        updateEgyptDateTime();
        setInterval(updateEgyptDateTime, 1000);

        // Global variable to store visit files
        let visitFiles = [];

        // Fetch files from GitHub repository
        async function fetchVisitFiles() {
            try {
                const response = await fetch('https://api.github.com/repos/Qualinova7/QualiNova/contents/');
                const files = await response.json();
                
                visitFiles = files
                    .filter(file => file.name.startsWith('A_') && file.name.endsWith('.xlsx'))
                    .map(file => {
                        // Extract client name and date from filename
                        const parts = file.name.replace('A_', '').replace('.xlsx', '').split('_');
                        const client = parts[0];
                        const date = `${parts[3]}-${parts[1]}-${parts[2]}`; // Format as YYYY-MM-DD
                        
                        return {
                            name: file.name,
                            client: client,
                            date: date,
                            downloadUrl: file.download_url
                        };
                    });
                
                // Update the UI with the fetched files
                populateClientList();
            } catch (error) {
                console.error('Error fetching visit files:', error);
                // Fallback to sample data if API fails
                visitFiles = [
                    { name: "A_CTOR_05_25_2025.xlsx", client: "CTOR", date: "2025-05-25" }
                ];
                populateClientList();
            }
        }

        // Get unique clients from visit files
        function getUniqueClients() {
            const clients = new Set();
            visitFiles.forEach(file => {
                clients.add(file.client);
            });
            return Array.from(clients);
        }

        // Populate client list in sidebar
        function populateClientList() {
            const clientList = document.getElementById('clientList');
            clientList.innerHTML = '';
            
            const clients = getUniqueClients();
            clients.forEach(client => {
                const li = document.createElement('li');
                li.textContent = client;
                clientList.appendChild(li);
            });
        }

        // Show visits page
        function showVisitsPage() {
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('visitsContainer').style.display = 'block';
            
            const visitsList = document.getElementById('clientVisitsList');
            visitsList.innerHTML = '';
            
            const clients = getUniqueClients();
            clients.forEach(client => {
                // Create client arrow
                const clientArrow = document.createElement('div');
                clientArrow.className = 'client-arrow';
                clientArrow.innerHTML = `
                    <span>${client}</span>
                    <span>▼</span>
                `;
                
                // Create files container
                const filesContainer = document.createElement('div');
                filesContainer.className = 'client-files';
                
                // Get files for this client and sort by date (newest first)
                const clientFiles = visitFiles
                    .filter(file => file.client === client)
                    .sort((a, b) => new Date(b.date) - new Date(a.date));
                
                clientFiles.forEach(file => {
                    const fileItem = document.createElement('div');
                    fileItem.className = 'file-item';
                    fileItem.textContent = file.name.replace('A_', '').replace('.xlsx', '');
                    fileItem.addEventListener('click', () => {
                        window.open(file.downloadUrl, '_blank');
                    });
                    filesContainer.appendChild(fileItem);
                });
                
                // Toggle files on click
                clientArrow.addEventListener('click', () => {
                    const isHidden = filesContainer.style.display === 'none' || filesContainer.style.display === '';
                    filesContainer.style.display = isHidden ? 'block' : 'none';
                    clientArrow.querySelector('span:last-child').textContent = isHidden ? '▲' : '▼';
                });
                
                visitsList.appendChild(clientArrow);
                visitsList.appendChild(filesContainer);
            });
        }

        // Event listeners
        document.getElementById('visitsButton').addEventListener('click', showVisitsPage);
        document.getElementById('backButton').addEventListener('click', () => {
            document.getElementById('mainContent').style.display = 'flex';
            document.getElementById('visitsContainer').style.display = 'none';
        });

        // Initialize the page by fetching files from GitHub
        fetchVisitFiles();
    </script>
</body>
</html>
