<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام إدارة سجلات معمل كواليتك إنترناشيونال</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
        }
        
        * {
            font-family: 'Cairo', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* Header Styles */
        .main-header {
            background: rgba(255, 255, 255, 0.95);
            color: var(--primary-color);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 40px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
        }
        
        .main-header:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #3498db, #9b59b6, #e74c3c, #2ecc71);
            background-size: 400% 400%;
            animation: gradientBG 10s ease infinite;
        }
        
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .main-header h1 {
            font-weight: 800;
            margin-bottom: 15px;
            font-size: 2.5rem;
            background: linear-gradient(90deg, #2c3e50, #3498db);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .main-header .lead {
            color: #5d6d7e;
            font-size: 1.1rem;
            line-height: 1.8;
        }
        
        /* System Cards Grid */
        .systems-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .system-card {
            background: rgba(255, 255, 255, 0.95);
            border: none;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            overflow: hidden;
            cursor: pointer;
            height: 100%;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            text-decoration: none;
            display: block;
            position: relative;
        }
        
        .system-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0,0,0,0.25);
            text-decoration: none;
        }
        
        .system-card:hover .card-icon {
            transform: scale(1.2) rotate(5deg);
        }
        
        .system-card:hover .card-count {
            transform: scale(1.1);
            background: var(--success-color);
        }
        
        .card-icon-wrapper {
            height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        .card-icon {
            font-size: 3.5rem;
            transition: all 0.4s ease;
        }
        
        .card-body-custom {
            padding: 25px;
            text-align: center;
            position: relative;
        }
        
        .card-title {
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--primary-color);
            margin-bottom: 10px;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* تعديل موقع دائرة السجلات */
        .card-count {
            position: absolute;
            top: 30px;
            left: 20px;
            background: var(--secondary-color);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3);
            z-index: 2;
        }
        
        /* إضافة دائرة الاختصار */
        .shortcut-key {
            position: absolute;
            bottom: 25px;
            left: 20px;
            background: var(--primary-color);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.8rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            z-index: 2;
            border: 2px solid white;
        }
        
        .card-description {
            color: #7f8c8d;
            font-size: 0.9rem;
            line-height: 1.6;
            margin-bottom: 15px;
            min-height: 60px;
        }
        
        /* System Colors */
        .system-card[data-system="calibration"] .card-icon-wrapper {
            background: linear-gradient(135deg, #3498db, #2980b9);
        }
        
        .system-card[data-system="impartiality"] .card-icon-wrapper {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
        }
        
        .system-card[data-system="contract"] .card-icon-wrapper {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }
        
        .system-card[data-system="supplier"] .card-icon-wrapper {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
        }
        
        .system-card[data-system="calibration-mgmt"] .card-icon-wrapper {
            background: linear-gradient(135deg, #1abc9c, #16a085);
        }
        
        .system-card[data-system="maintenance"] .card-icon-wrapper {
            background: linear-gradient(135deg, #e67e22, #d35400);
        }
        
        .system-card[data-system="devices"] .card-icon-wrapper {
            background: linear-gradient(135deg, #8e44ad, #9b59b6);
        }
        
        .system-card[data-system="fmea"] .card-icon-wrapper {
            background: linear-gradient(135deg, #7d3c98, #6c3483);
        }
        
        .system-card[data-system="corrective"] .card-icon-wrapper {
            background: linear-gradient(135deg, #c0392b, #a93226);
        }
        
        .system-card[data-system="environmental"] .card-icon-wrapper {
            background: linear-gradient(135deg, #16a085, #138d75);
        }
        
        .system-card[data-system="training"] .card-icon-wrapper {
            background: linear-gradient(135deg, #8e44ad, #7d3c98);
        }
        
        /* الأنظمة الجديدة */
        .system-card[data-system="delegation"] .card-icon-wrapper {
            background: linear-gradient(135deg, #8e44ad, #9b59b6);
        }
        
        .system-card[data-system="complaints"] .card-icon-wrapper {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }
        
        .system-card[data-system="employee-skills"] .card-icon-wrapper {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
        }
        
        .system-card[data-system="ncr"] .card-icon-wrapper {
            background: linear-gradient(135deg, #e67e22, #d35400);
        }
        
        /* Action Button */
        .card-action-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            cursor: pointer;
        }
        
        .card-action-btn:hover {
            background: #1a2530;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        /* Stats Overview */
        .stats-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .stat-card {
            text-align: center;
            padding: 20px;
        }
        
        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: var(--secondary-color);
        }
        
        .stat-number {
            font-size: 2.2rem;
            font-weight: 800;
            color: var(--primary-color);
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        /* Quick Actions */
        .quick-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .quick-action-btn {
            background: rgba(255, 255, 255, 0.95);
            border: none;
            border-radius: 15px;
            padding: 12px 25px;
            font-weight: 600;
            color: var(--primary-color);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            cursor: pointer;
        }
        
        .quick-action-btn:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-3px);
        }
        
        /* Footer */
        .main-footer {
            text-align: center;
            color: rgba(255,255,255,0.8);
            padding: 30px 0;
            margin-top: 40px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        
        /* Responsive Design */
        @media (max-width: 1200px) {
            .systems-grid {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            }
        }
        
        @media (max-width: 768px) {
            .main-header h1 {
                font-size: 2rem;
            }
            
            .systems-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 20px;
            }
            
            .main-header, .stats-container {
                padding: 20px;
            }
            
            .quick-actions {
                flex-direction: column;
                align-items: center;
            }
            
            .quick-action-btn {
                width: 100%;
                justify-content: center;
            }
            
            .card-count {
                top: 20px;
                left: 15px;
                width: 35px;
                height: 35px;
                font-size: 0.8rem;
            }
            
            .shortcut-key {
                bottom: 20px;
                left: 15px;
                width: 28px;
                height: 28px;
                font-size: 0.75rem;
            }
        }
        
        @media (max-width: 576px) {
            .systems-grid {
                grid-template-columns: 1fr;
            }
            
            body {
                padding: 15px;
            }
            
            .card-count {
                top: 15px;
                left: 15px;
            }
            
            .shortcut-key {
                bottom: 15px;
                left: 15px;
            }
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.3);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.5);
        }
        
        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 15px 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transform: translateX(150%);
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 1000;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
            max-width: 400px;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            border-right: 5px solid var(--success-color);
        }
        
        .notification.error {
            border-right: 5px solid var(--danger-color);
        }
        
        /* Search Bar */
        .search-container {
            position: relative;
            margin-bottom: 30px;
        }
        
        .search-input {
            width: 100%;
            padding: 15px 20px 15px 50px;
            border: none;
            border-radius: 50px;
            background: rgba(255,255,255,0.95);
            font-size: 1rem;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        
        .search-input:focus {
            outline: none;
            box-shadow: 0 8px 30px rgba(0,0,0,0.2);
            transform: translateY(-2px);
        }
        
        .search-icon {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary-color);
            font-size: 1.2rem;
        }
        
        /* Remove default link styling */
        a.system-card, a.system-card:hover, a.system-card:focus, a.system-card:active {
            text-decoration: none;
            color: inherit;
        }
        
        /* Background update indicator */
        .update-indicator {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 8px 15px;
            font-size: 0.8rem;
            color: var(--primary-color);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 8px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
        }
        
        .update-indicator.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .update-indicator.updating .update-spinner {
            display: inline-block;
        }
        
        .update-spinner {
            display: none;
            width: 12px;
            height: 12px;
            border: 2px solid rgba(52, 152, 219, 0.3);
            border-radius: 50%;
            border-top-color: var(--secondary-color);
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Export Progress Modal */
        .export-progress {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .export-progress.active {
            opacity: 1;
            visibility: visible;
        }
        
        .export-modal {
            background: white;
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .export-progress-bar {
            height: 10px;
            background: #ecf0f1;
            border-radius: 5px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .export-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #2ecc71, #27ae60);
            border-radius: 5px;
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .export-file-list {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 15px;
        }
        
        .export-file-item {
            display: flex;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        
        .export-file-item i {
            margin-left: 10px;
            color: #27ae60;
        }
        
        .export-file-item.completed i {
            color: #27ae60;
        }
        
        .export-file-item.pending i {
            color: #f39c12;
        }
        
        .export-file-item.error i {
            color: #e74c3c;
        }
    </style>
</head>
<body>
    <!-- Notification -->
    <div class="notification" id="notification"></div>
    
    <!-- Export Progress Modal -->
    <div class="export-progress" id="exportProgress">
        <div class="export-modal">
            <h4 class="text-center mb-3">
                <i class="fas fa-file-export me-2"></i>
                جاري تصدير البيانات
            </h4>
            <div class="text-center mb-3" id="exportFolderName">
                مجلد: Records_----/--/--
            </div>
            <div class="export-progress-bar">
                <div class="export-progress-fill" id="exportProgressFill"></div>
            </div>
            <div class="text-center mb-2">
                <span id="exportProgressText">0%</span>
                <span> - </span>
                <span id="exportCurrentFile">جاري الإعداد...</span>
            </div>
            <div class="export-file-list" id="exportFileList"></div>
            <div class="text-center mt-4">
                <button class="btn btn-secondary" onclick="cancelExport()">
                    <i class="fas fa-times me-1"></i>
                    إلغاء
                </button>
            </div>
        </div>
    </div>
    
    <!-- Background Update Indicator -->
    <div class="update-indicator" id="updateIndicator">
        <span class="update-spinner"></span>
        <span id="updateMessage">جاري تحديث البيانات...</span>
    </div>
    
    <!-- Main Container -->
    <div class="main-container">
        <!-- Header -->
        <div class="main-header">
            <div class="row align-items-center">
                <div class="col-lg-8">
                    <h1><i class="fas fa-tasks me-3"></i> نظام إدارة السجلات المتكامل</h1>
                    <p class="lead">
                        إدارة 15 نظام متكاملة لمعمل كواليتك إنترناشيونال. نظام شامل لإدارة سجلات السرية، الحيادية، العقود، الموردين، المعايرة، الصيانة، الأجهزة، المخاطر، الإجراءات التصحيحية، الظروف البيئية، التدريب، تفويض الصلاحيات، الشكاوى، تقييم الموظفين، وعدم المطابقة.
                    </p>
                </div>
                <div class="col-lg-4 text-lg-end text-center mt-4 mt-lg-0">
                    <div class="d-flex flex-column flex-md-row justify-content-lg-end gap-3">
                        <div class="d-inline-flex align-items-center bg-primary text-white px-3 py-2 rounded-pill">
                            <i class="fas fa-calendar-alt me-2"></i>
                            <span id="currentDate">--/--/----</span>
                        </div>
                        <div class="d-inline-flex align-items-center bg-success text-white px-3 py-2 rounded-pill">
                            <i class="fas fa-user-shield me-2"></i>
                            <span>مدير النظام</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Search Bar -->
        <div class="search-container">
            <input type="text" class="search-input" id="searchInput" placeholder="ابحث عن النظام المطلوب...">
            <i class="fas fa-search search-icon"></i>
        </div>
        
        <!-- Stats Overview -->
        <div class="stats-container">
            <div class="row text-center">
                <div class="col-md-4 col-6 mb-4">
                    <div class="stat-card">
                        <i class="fas fa-database stat-icon"></i>
                        <div class="stat-number" id="totalRecords">0</div>
                        <div class="stat-label">إجمالي السجلات</div>
                    </div>
                </div>
                <div class="col-md-4 col-6 mb-4">
                    <div class="stat-card">
                        <i class="fas fa-check-circle stat-icon"></i>
                        <div class="stat-number" id="activeSystems">15</div>
                        <div class="stat-label">نظام نشط</div>
                    </div>
                </div>
                <div class="col-md-4 col-12 mb-4">
                    <div class="stat-card">
                        <i class="fas fa-sync-alt stat-icon"></i>
                        <div class="stat-number" id="lastUpdate">اليوم</div>
                        <div class="stat-label">آخر تحديث</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Systems Grid -->
        <div class="systems-grid" id="systemsGrid">
            <!-- System 1: Calibration (سرية) -->
            <a href="https://qualinova7.github.io/QualiNova/%D9%86%D8%B8%D8%A7%D9%85%20%D8%A5%D8%AF%D8%A7%D8%B1%D8%A9%20%D8%B3%D8%AC%D9%84%D8%A7%D8%AA%20%D8%A7%D9%84%D8%B3%D8%B1%D9%8A%D8%A9.html" class="system-card" data-system="calibration" data-shortcut="A">
                <div class="card-icon-wrapper">
                    <i class="fas fa-file-contract card-icon text-white"></i>
                    <span class="card-count" id="count-calibration">0</span>
                    <span class="shortcut-key">A</span>
                </div>
                <div class="card-body-custom">
                    <h3 class="card-title">نظام إدارة سجلات السرية</h3>
                    <p class="card-description">
                        إدارة سجلات السرية والاتفاقيات الوظيفية للموظفين
                    </p>
                    <div class="card-action-btn">
                        <i class="fas fa-external-link-alt"></i>
                        فتح النظام
                    </div>
                </div>
            </a>
            
            <!-- System 2: Impartiality (حيادية) -->
            <a href="https://qualinova7.github.io/QualiNova/%D9%86%D8%B8%D8%A7%D9%85%20%D8%A5%D8%AF%D8%A7%D8%B1%D8%A9%20%D8%B3%D8%AC%D9%84%D8%A7%D8%AA%20%D8%A5%D9%81%D8%B5%D8%A7%D8%AD%D8%A7%D8%AA%20%D8%A7%D9%84%D8%AD%D9%8A%D8%A7%D8%AF%D9%8A%D8%A9.html" class="system-card" data-system="impartiality" data-shortcut="B">
                <div class="card-icon-wrapper">
                    <i class="fas fa-balance-scale card-icon text-white"></i>
                    <span class="card-count" id="count-impartiality">0</span>
                    <span class="shortcut-key">B</span>
                </div>
                <div class="card-body-custom">
                    <h3 class="card-title">نظام إفصاحات الحيادية</h3>
                    <p class="card-description">
                        إدارة إفصاحات وتعريفات مصالح ومخاطر الحيادية
                    </p>
                    <div class="card-action-btn">
                        <i class="fas fa-external-link-alt"></i>
                        فتح النظام
                    </div>
                </div>
            </a>
            
            <!-- System 3: Contract (عقود) -->
            <a href="https://qualinova7.github.io/QualiNova/%D9%86%D8%B8%D8%A7%D9%85%20%D8%A5%D8%AF%D8%A7%D8%B1%D8%A9%20%D8%A7%D9%84%D8%B9%D9%82%D9%88%D8%AF.html" class="system-card" data-system="contract" data-shortcut="C">
                <div class="card-icon-wrapper">
                    <i class="fas fa-file-signature card-icon text-white"></i>
                    <span class="card-count" id="count-contract">0</span>
                    <span class="shortcut-key">C</span>
                </div>
                <div class="card-body-custom">
                    <h3 class="card-title">نظام إدارة العقود</h3>
                    <p class="card-description">
                        إدارة عقود العملاء والاتفاقيات والالتزامات
                    </p>
                    <div class="card-action-btn">
                        <i class="fas fa-external-link-alt"></i>
                        فتح النظام
                    </div>
                </div>
            </a>
            
            <!-- System 4: Supplier (موردين) -->
            <a href="https://qualinova7.github.io/QualiNova/%D9%86%D8%B8%D8%A7%D9%85%20%D8%A5%D8%AF%D8%A7%D8%B1%D8%A9%20%D9%88%D8%AA%D9%82%D9%8A%D9%8A%D9%85%20%D8%A7%D9%84%D9%85%D9%88%D8%B1%D8%AF%D9%8A%D9%86.html" class="system-card" data-system="supplier" data-shortcut="D">
                <div class="card-icon-wrapper">
                    <i class="fas fa-truck card-icon text-white"></i>
                    <span class="card-count" id="count-supplier">0</span>
                    <span class="shortcut-key">D</span>
                </div>
                <div class="card-body-custom">
                    <h3 class="card-title">نظام إدارة وتقييم الموردين</h3>
                    <p class="card-description">
                        إدارة وتقييم الموردين والاعتمادات والمتابعة
                    </p>
                    <div class="card-action-btn">
                        <i class="fas fa-external-link-alt"></i>
                        فتح النظام
                    </div>
                </div>
            </a>
            
            <!-- System 5: Calibration Management (معايرة) -->
            <a href="https://qualinova7.github.io/QualiNova/%D9%86%D8%B8%D8%A7%D9%85%20%D8%A5%D8%AF%D8%A7%D8%B1%D8%A9%20%D8%B3%D8%AC%D9%84%D8%A7%D8%AA%20%D8%A7%D9%84%D9%85%D8%B9%D8%A7%D9%8A%D8%B1%D8%A9.html" class="system-card" data-system="calibration-mgmt" data-shortcut="E">
                <div class="card-icon-wrapper">
                    <i class="fas fa-tools card-icon text-white"></i>
                    <span class="card-count" id="count-calibration-mgmt">0</span>
                    <span class="shortcut-key">E</span>
                </div>
                <div class="card-body-custom">
                    <h3 class="card-title">نظام إدارة سجلات المعايرة</h3>
                    <p class="card-description">
                        إدارة شهادات المعايرة والتتبع والاستحقاق
                    </p>
                    <div class="card-action-btn">
                        <i class="fas fa-external-link-alt"></i>
                        فتح النظام
                    </div>
                </div>
            </a>
            
            <!-- System 6: Maintenance (صيانة) -->
            <a href="https://qualinova7.github.io/QualiNova/%D9%86%D8%B8%D8%A7%D9%85%20%D8%A5%D8%AF%D8%A7%D8%B1%D8%A9%20%D8%B3%D8%AC%D9%84%D8%A7%D8%AA%20%D8%A7%D9%84%D8%B5%D9%8A%D8%A7%D9%86%D8%A9.html" class="system-card" data-system="maintenance" data-shortcut="F">
                <div class="card-icon-wrapper">
                    <i class="fas fa-wrench card-icon text-white"></i>
                    <span class="card-count" id="count-maintenance">0</span>
                    <span class="shortcut-key">F</span>
                </div>
                <div class="card-body-custom">
                    <h3 class="card-title">نظام إدارة سجلات الصيانة</h3>
                    <p class="card-description">
                        إدارة سجلات الصيانة الوقائية والتصحيحية للأجهزة
                    </p>
                    <div class="card-action-btn">
                        <i class="fas fa-external-link-alt"></i>
                        فتح النظام
                    </div>
                </div>
            </a>
            
            <!-- System 7: Devices (أجهزة) -->
            <a href="https://qualinova7.github.io/QualiNova/%D9%86%D8%B8%D8%A7%D9%85%20%D8%A5%D8%AF%D8%A7%D8%B1%D8%A9%20%D8%A3%D8%AC%D9%87%D8%B2%D8%A9%20%D8%A7%D9%84%D9%85%D8%B9%D8%A7%D9%8A%D8%B1%D8%A9.html" class="system-card" data-system="devices" data-shortcut="G">
                <div class="card-icon-wrapper">
                    <i class="fas fa-microchip card-icon text-white"></i>
                    <span class="card-count" id="count-devices">0</span>
                    <span class="shortcut-key">G</span>
                </div>
                <div class="card-body-custom">
                    <h3 class="card-title">نظام إدارة أجهزة المعايرة</h3>
                    <p class="card-description">
                        إدارة سجل الأجهزة والمواصفات والتتبع
                    </p>
                    <div class="card-action-btn">
                        <i class="fas fa-external-link-alt"></i>
                        فتح النظام
                    </div>
                </div>
            </a>
            
            <!-- System 8: FMEA (مخاطر) -->
            <a href="https://qualinova7.github.io/QualiNova/%D9%86%D8%B8%D8%A7%D9%85%20%D8%AA%D8%AD%D9%84%D9%8A%D9%84%20%D8%A7%D9%84%D9%85%D8%AE%D8%A7%D8%B7%D8%B1.html" class="system-card" data-system="fmea" data-shortcut="H">
                <div class="card-icon-wrapper">
                    <i class="fas fa-exclamation-triangle card-icon text-white"></i>
                    <span class="card-count" id="count-fmea">0</span>
                    <span class="shortcut-key">H</span>
                </div>
                <div class="card-body-custom">
                    <h3 class="card-title">نظام تحليل المخاطر (FMEA)</h3>
                    <p class="card-description">
                        تحليل وتقييم المخاطر والإجراءات الوقائية
                    </p>
                    <div class="card-action-btn">
                        <i class="fas fa-external-link-alt"></i>
                        فتح النظام
                    </div>
                </div>
            </a>
            
            <!-- System 9: Corrective Actions (تصحيحية) -->
            <a href="https://qualinova7.github.io/QualiNova/%D9%86%D8%B8%D8%A7%D9%85%20%D8%A5%D8%AF%D8%A7%D8%B1%D8%A9%20%D8%A7%D9%84%D8%B3%D8%AC%D9%84%D8%A7%D8%AA%20%D8%A7%D9%84%D8%AA%D8%B5%D8%AD%D9%8A%D8%AD%D9%8A%D8%A9.html" class="system-card" data-system="corrective" data-shortcut="I">
                <div class="card-icon-wrapper">
                    <i class="fas fa-clipboard-check card-icon text-white"></i>
                    <span class="card-count" id="count-corrective">0</span>
                    <span class="shortcut-key">I</span>
                </div>
                <div class="card-body-custom">
                    <h3 class="card-title">نظام السجلات التصحيحية (CAPA/NCR)</h3>
                    <p class="card-description">
                        إدارة الإجراءات التصحيحية والوقائية
                    </p>
                    <div class="card-action-btn">
                        <i class="fas fa-external-link-alt"></i>
                        فتح النظام
                    </div>
                </div>
            </a>
            
            <!-- System 10: Environmental (بيئية) -->
            <a href="https://qualinova7.github.io/QualiNova/%D9%86%D8%B8%D8%A7%D9%85%20%D8%A5%D8%AF%D8%A7%D8%B1%D8%A9%20%D8%B3%D8%AC%D9%84%D8%A7%D8%AA%20%D8%A7%D9%84%D8%B8%D8%B1%D9%88%D9%81%20%D8%A7%D9%84%D8%A8%D9%8A%D8%A6%D9%8A%D8%A9.html" class="system-card" data-system="environmental" data-shortcut="J">
                <div class="card-icon-wrapper">
                    <i class="fas fa-temperature-high card-icon text-white"></i>
                    <span class="card-count" id="count-environmental">0</span>
                    <span class="shortcut-key">J</span>
                </div>
                <div class="card-body-custom">
                    <h3 class="card-title">نظام متابعة الظروف البيئية</h3>
                    <p class="card-description">
                        متابعة ومراقبة الظروف البيئية للمعامل
                    </p>
                    <div class="card-action-btn">
                        <i class="fas fa-external-link-alt"></i>
                        فتح النظام
                    </div>
                </div>
            </a>
            
            <!-- System 11: Training (تدريب) -->
            <a href="https://qualinova7.github.io/QualiNova/%D9%86%D8%B8%D8%A7%D9%85%20%D8%A5%D8%AF%D8%A7%D8%B1%D8%A9%20%D8%B3%D8%AC%D9%84%D8%A7%D8%AA%20%D8%A7%D9%84%D8%AA%D8%AF%D8%B1%D9%8A%D8%A8.html" class="system-card" data-system="training" data-shortcut="K">
                <div class="card-icon-wrapper">
                    <i class="fas fa-graduation-cap card-icon text-white"></i>
                    <span class="card-count" id="count-training">0</span>
                    <span class="shortcut-key">K</span>
                </div>
                <div class="card-body-custom">
                    <h3 class="card-title">نظام إدارة التدريب</h3>
                    <p class="card-description">
                        إدارة سجلات التدريب والتطوير والتأهيل
                    </p>
                    <div class="card-action-btn">
                        <i class="fas fa-external-link-alt"></i>
                        فتح النظام
                    </div>
                </div>
            </a>
            
            <!-- النظام 12: تفويض الصلاحيات (جديد) -->
            <a href="https://qualinova7.github.io/QualiNova/%D8%B3%D8%AC%D9%84%20%D8%AA%D9%81%D9%88%D9%8A%D8%B6%20%D8%A7%D9%84%D9%85%D9%88%D8%B8%D9%81%D9%8A%D9%86.html" class="system-card" data-system="delegation" data-shortcut="L">
                <div class="card-icon-wrapper">
                    <i class="fas fa-user-shield card-icon text-white"></i>
                    <span class="card-count" id="count-delegation">0</span>
                    <span class="shortcut-key">L</span>
                </div>
                <div class="card-body-custom">
                    <h3 class="card-title">نظام إدارة تفويض الصلاحيات</h3>
                    <p class="card-description">
                        إدارة تفويض الصلاحيات والتوقيعات والقيود ومراجعة التفويض
                    </p>
                    <div class="card-action-btn">
                        <i class="fas fa-external-link-alt"></i>
                        فتح النظام
                    </div>
                </div>
            </a>
            
            <!-- النظام 13: إدارة الشكاوى (جديد) -->
            <a href="https://qualinova7.github.io/QualiNova/%D9%86%D8%B8%D8%A7%D9%85%20%D8%A7%D8%AF%D8%A7%D8%B1%D8%A9%20%D8%A7%D9%84%D8%B4%D9%83%D8%A7%D9%88%D9%89.html" class="system-card" data-system="complaints" data-shortcut="M">
                <div class="card-icon-wrapper">
                    <i class="fas fa-clipboard-list card-icon text-white"></i>
                    <span class="card-count" id="count-complaints">0</span>
                    <span class="shortcut-key">M</span>
                </div>
                <div class="card-body-custom">
                    <h3 class="card-title">نظام إدارة سجلات الشكاوى</h3>
                    <p class="card-description">
                        إدارة وتتبع جميع الشكاوى المقدمة من العملاء وحل المشكلات
                    </p>
                    <div class="card-action-btn">
                        <i class="fas fa-external-link-alt"></i>
                        فتح النظام
                    </div>
                </div>
            </a>
            
            <!-- النظام 14: تقييم مهارات الموظفين (جديد) -->
            <a href="https://qualinova7.github.io/QualiNova/%D9%86%D8%B8%D8%A7%D9%85%20%D8%AA%D9%82%D9%8A%D9%8A%D9%85%20%D8%A7%D9%84%D9%85%D9%88%D8%B8%D9%81%D9%8A%D9%86.html" class="system-card" data-system="employee-skills" data-shortcut="N">
                <div class="card-icon-wrapper">
                    <i class="fas fa-user-tie card-icon text-white"></i>
                    <span class="card-count" id="count-employee-skills">0</span>
                    <span class="shortcut-key">N</span>
                </div>
                <div class="card-body-custom">
                    <h3 class="card-title">نظام تقييم مهارات الموظفين</h3>
                    <p class="card-description">
                        إدارة وتقييم كفاءات الموظفين وتحديد فجوات التدريب والمهارات
                    </p>
                    <div class="card-action-btn">
                        <i class="fas fa-external-link-alt"></i>
                        فتح النظام
                    </div>
                </div>
            </a>
            
            <!-- النظام 15: سجلات عدم المطابقة (جديد) -->
            <a href="https://qualinova7.github.io/QualiNova/%D9%86%D8%B8%D8%A7%D9%85%20%D8%A5%D8%AF%D8%A7%D8%B1%D8%A9%20%D8%B3%D8%AC%D9%84%D8%A7%D8%AA%20%D8%B9%D8%AF%D9%85%20%D8%A7%D9%84%D9%85%D8%B7%D8%A7%D8%A8%D9%82%D8%A9.html" class="system-card" data-system="ncr" data-shortcut="O">
                <div class="card-icon-wrapper">
                    <i class="fas fa-ban card-icon text-white"></i>
                    <span class="card-count" id="count-ncr">0</span>
                    <span class="shortcut-key">O</span>
                </div>
                <div class="card-body-custom">
                    <h3 class="card-title">نظام إدارة سجلات عدم المطابقة</h3>
                    <p class="card-description">
                        إدارة سجلات عدم المطابقة والمراجعة والتحكم في العملية التصحيحية
                    </p>
                    <div class="card-action-btn">
                        <i class="fas fa-external-link-alt"></i>
                        فتح النظام
                    </div>
                </div>
            </a>
        </div>
        
        <!-- Quick Actions -->
        <div class="text-center mb-5">
            <h3 class="text-white mb-4" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">
                <i class="fas fa-bolt me-2"></i>إجراءات سريعة
            </h3>
            <div class="quick-actions">
                <button class="quick-action-btn" onclick="loadAllRecords()">
                    <i class="fas fa-sync-alt"></i>
                    تحديث جميع البيانات
                </button>
                <button class="quick-action-btn" onclick="showAllStats()">
                    <i class="fas fa-chart-bar"></i>
                    عرض إحصائيات كاملة
                </button>
                <button class="quick-action-btn" onclick="exportAllExcelSheets()">
                    <i class="fas fa-file-export"></i>
                    تصدير جميع البيانات
                </button>
                <button class="quick-action-btn" onclick="openHelp()">
                    <i class="fas fa-question-circle"></i>
                    المساعدة والدعم
                </button>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="main-footer">
            <div class="row align-items-center">
                <div class="col-md-6 text-md-start text-center mb-3 mb-md-0">
                    <p class="mb-0">
                        <i class="fas fa-copyright me-1"></i>
                        جميع الحقوق محفوظة © معمل كواليتك إنترناشيونال 
                        <span id="currentYear"></span>
                    </p>
                </div>
                <div class="col-md-6 text-md-end text-center">
                    <div class="d-flex justify-content-center justify-content-md-end gap-3">
                        <span class="text-light">
                            <i class="fas fa-code me-1"></i>
                            الإصدار 15.0
                        </span>
                        <span class="text-light">
                            <i class="fas fa-database me-1"></i>
                            نظام متكامل
                        </span>
                        <span class="text-light">
                            <i class="fas fa-shield-alt me-1"></i>
                            آمن ومشفّر
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Main JavaScript -->
    <script>
        // Configuration
        const SYSTEM_URLS = {
            calibration: "https://qualinova7.github.io/QualiNova/%D9%86%D8%B8%D8%A7%D9%85%20%D8%A5%D8%AF%D8%A7%D8%B1%D8%A9%20%D8%B3%D8%AC%D9%84%D8%A7%D8%AA%20%D8%A7%D9%84%D8%B3%D8%B1%D9%8A%D8%A9.html",
            impartiality: "https://qualinova7.github.io/QualiNova/%D9%86%D8%B8%D8%A7%D9%85%20%D8%A5%D8%AF%D8%A7%D8%B1%D8%A9%20%D8%B3%D8%AC%D9%84%D8%A7%D8%AA%20%D8%A5%D9%81%D8%B5%D8%A7%D8%AD%D8%A7%D8%AA%20%D8%A7%D9%84%D8%AD%D9%8A%D8%A7%D8%AF%D9%8A%D8%A9.html",
            contract: "https://qualinova7.github.io/QualiNova/%D9%86%D8%B8%D8%A7%D9%85%20%D8%A5%D8%AF%D8%A7%D8%B1%D8%A9%20%D8%A7%D9%84%D8%B9%D9%82%D9%88%D8%AF.html",
            supplier: "https://qualinova7.github.io/QualiNova/%D9%86%D8%B8%D8%A7%D9%85%20%D8%A5%D8%AF%D8%A7%D8%B1%D8%A9%20%D9%88%D8%AA%D9%82%D9%8A%D9%8A%D9%85%20%D8%A7%D9%84%D9%85%D9%88%D8%B1%D8%AF%D9%8A%D9%86.html",
            "calibration-mgmt": "https://qualinova7.github.io/QualiNova/%D9%86%D8%B8%D8%A7%D9%85%20%D8%A5%D8%AF%D8%A7%D8%B1%D8%A9%20%D8%B3%D8%AC%D9%84%D8%A7%D8%AA%20%D8%A7%D9%84%D9%85%D8%B9%D8%A7%D9%8A%D8%B1%D8%A9.html",
            maintenance: "https://qualinova7.github.io/QualiNova/%D9%86%D8%B8%D8%A7%D9%85%20%D8%A5%D8%AF%D8%A7%D8%B1%D8%A9%20%D8%B3%D8%AC%D9%84%D8%A7%D8%AA%20%D8%A7%D9%84%D8%B5%D9%8A%D8%A7%D9%86%D8%A9.html",
            devices: "https://qualinova7.github.io/QualiNova/%D9%86%D8%B8%D8%A7%D9%85%20%D8%A5%D8%AF%D8%A7%D8%B1%D8%A9%20%D8%A3%D8%AC%D9%87%D8%B2%D8%A9%20%D8%A7%D9%84%D9%85%D8%B9%D8%A7%D9%8A%D8%B1%D8%A9.html",
            fmea: "https://qualinova7.github.io/QualiNova/%D9%86%D8%B8%D8%A7%D9%85%20%D8%AA%D8%AD%D9%84%D9%8A%D9%84%20%D8%A7%D9%84%D9%85%D8%AE%D8%A7%D8%B7%D8%B1.html",
            corrective: "https://qualinova7.github.io/QualiNova/%D9%86%D8%B8%D8%A7%D9%85%20%D8%A5%D8%AF%D8%A7%D8%B1%D8%A9%20%D8%A7%D9%84%D8%B3%D8%AC%D9%84%D8%A7%D8%AA%20%D8%A7%D9%84%D8%AA%D8%B5%D8%AD%D9%8A%D8%AD%D9%8A%D8%A9.html",
            environmental: "https://qualinova7.github.io/QualiNova/%D9%86%D8%B8%D8%A7%D9%85%20%D8%A5%D8%AF%D8%A7%D8%B1%D8%A9%20%D8%B3%D8%AC%D9%84%D8%A7%D8%AA%20%D8%A7%D9%84%D8%B8%D8%B1%D9%88%D9%81%20%D8%A7%D9%84%D8%A8%D9%8A%D8%A6%D9%8A%D8%A9.html",
            training: "https://qualinova7.github.io/QualiNova/%D9%86%D8%B8%D8%A7%D9%85%20%D8%A5%D8%AF%D8%A7%D8%B1%D8%A9%20%D8%B3%D8%AC%D9%84%D8%A7%D8%AA%20%D8%A7%D9%84%D8%AA%D8%AF%D8%B1%D9%8A%D8%A8.html",
            delegation: "https://qualinova7.github.io/QualiNova/%D8%B3%D8%AC%D9%84%20%D8%AA%D9%81%D9%88%D9%8A%D8%B6%20%D8%A7%D9%84%D9%85%D9%88%D8%B8%D9%81%D9%8A%D9%86.html",
            complaints: "https://qualinova7.github.io/QualiNova/%D9%86%D8%B8%D8%A7%D9%85%20%D8%A7%D8%AF%D8%A7%D8%B1%D8%A9%20%D8%A7%D9%84%D8%B4%D9%83%D8%A7%D9%88%D9%89.html",
            "employee-skills": "https://qualinova7.github.io/QualiNova/%D9%86%D8%B8%D8%A7%D9%85%20%D8%AA%D9%82%D9%8A%D9%8A%D9%85%20%D8%A7%D9%84%D9%85%D9%88%D8%B8%D9%81%D9%8A%D9%86.html",
            ncr: "https://qualinova7.github.io/QualiNova/%D9%86%D8%B8%D8%A7%D9%85%20%D8%A5%D8%AF%D8%A7%D8%B1%D8%A9%20%D8%B3%D8%AC%D9%84%D8%A7%D8%AA%20%D8%B9%D8%AF%D9%85%20%D8%A7%D9%84%D9%85%D8%B7%D8%A7%D8%A8%D9%82%D8%A9.html"
        };
        
        const API_URLS = {
            calibration: "https://script.google.com/macros/s/AKfycbxxzUljzgWR0jBrrp61DWBUxVB-Ku5bH3I736KHlrpJAHaQlPOAaklbswpPOi1Wut14/exec",
            impartiality: "https://script.google.com/macros/s/AKfycbzXSFMWC-nBHKu7iWUfihxiO5UKK4bjSybTpqV57sxDTGxtabgbi9m73KbIWpqn6o38jw/exec",
            contract: "https://script.google.com/macros/s/AKfycbwwQGNVgO33TgCISOpBGi2Gb06xIm4RYVGx9PKgwapour1g-21BbzlwsACAyAMMhyoZog/exec",
            supplier: "https://script.google.com/macros/s/AKfycbzjLyLn0eia6MXUJ1KUuiTKq6bt-Ss0Z8b3Qs91xHZ0eWQ1f8hHbqlTJlrNA2rVUnkH/exec",
            "calibration-mgmt": "https://script.google.com/macros/s/AKfycbxFjbZUmkSTYseIG5L_i49f7s-xNduqMxSVQzKBRoAI-zw1vMD9q71VSCtR0JPHQacT/exec",
            maintenance: "https://script.google.com/macros/s/AKfycbzkSfYOpZbOnYBlBuHoIJUzVqvhJGiHB9f7EnvY1O_w5Plf_iJ8U0-4CpjB2SyZLXl57w/exec",
            devices: "https://script.google.com/macros/s/AKfycbz7dvO_bpNX9RaVt8q75N3EutSecivsNLthLtHZO2-CJobc6lAWGrD98reId_NAKY-I/exec",
            fmea: "https://script.google.com/macros/s/AKfycby314ii-A-5OQrfCpd14wGcEXBIuQh9qlrFccf14QmRKuz9WbwtRp7lzuhERVw67UAzVg/exec",
            corrective: "https://script.google.com/macros/s/AKfycby5I5LQAZg_nou7flikY-9qJRN8lmvjXYZlXF42PYID2kXluhnIrDtkFI2ck9Oj_HuZvA/exec",
            environmental: "https://script.google.com/macros/s/AKfycbyEKz485uet9gaYlrbqETzvk6xjw64wtKgG3yL6XPmC1VsD15ADFW1mXOfVbA0XGfxd/exec",
            training: "https://script.google.com/macros/s/AKfycbyhspPy9B2RGQdv6cCb-6y4VfQQPOkUXPgaT118s6qV9mqvdR9zLy9XknDAJdW7AYcM_g/exec",
            delegation: "https://script.google.com/macros/s/AKfycbwnQeMasA2IThUIVMy5nn-_c1TwePITdoSM8-z8ldE15SuAbBTWJyJGyaV9eHLOgx9sdg/exec",
            complaints: "https://script.google.com/macros/s/AKfycbzNgDdk_hMp_LUuOjSFt9mf2Pgk2LS0HuLH7VFxmvz8CDN_lBQz6YP4ZfQqYMZ8tUeIzQ/exec",
            "employee-skills": "https://script.google.com/macros/s/AKfycbwwwXD8i0dgJhfpixMYvdxKx_e7_fZ5KZqFTek97DUvxyfsBvIv5DK2YtL0OOWWCif8/exec",
            ncr: "https://script.google.com/macros/s/AKfycbzljEO6Cc7ZuLQOJrBygcGqJA4IrZKf_YgkqT0A02BnhL7bzilYQER2NRiRIPLudQ5mzA/exec"
        };
        
        // Global variables
        let systemRecords = {
            calibration: 0,
            impartiality: 0,
            contract: 0,
            supplier: 0,
            "calibration-mgmt": 0,
            maintenance: 0,
            devices: 0,
            fmea: 0,
            corrective: 0,
            environmental: 0,
            training: 0,
            delegation: 0,
            complaints: 0,
            "employee-skills": 0,
            ncr: 0
        };
        
        let systemData = {}; // لتخزين البيانات الفعلية من الأنظمة
        let exportInProgress = false;
        let exportCancelled = false;
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Set current date and year
            setCurrentDate();
            document.getElementById('currentYear').textContent = new Date().getFullYear();
            
            // Set up search functionality
            setupSearch();
            
            // Load initial data in background (no loading screen)
            setTimeout(() => {
                loadAllRecords(true); // true = background mode
            }, 500);
            
            // Add keyboard shortcuts (A-Z)
            setupKeyboardShortcuts();
            
            // Add system card animations
            animateSystemCards();
            
            // Add click event listeners to system cards
            setupSystemCardLinks();
        });
        
        // Set current date
        function setCurrentDate() {
            const now = new Date();
            const day = now.getDate().toString().padStart(2, '0');
            const month = (now.getMonth() + 1).toString().padStart(2, '0');
            const year = now.getFullYear();
            document.getElementById('currentDate').textContent = `${day}/${month}/${year}`;
        }
        
        // Setup search functionality
        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            const systemCards = document.querySelectorAll('.system-card');
            
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                
                systemCards.forEach(card => {
                    const title = card.querySelector('.card-title').textContent.toLowerCase();
                    const description = card.querySelector('.card-description').textContent.toLowerCase();
                    const system = card.getAttribute('data-system');
                    
                    if (title.includes(searchTerm) || 
                        description.includes(searchTerm) || 
                        getSystemArabicName(system).toLowerCase().includes(searchTerm)) {
                        card.style.display = 'block';
                        setTimeout(() => {
                            card.style.opacity = '1';
                            card.style.transform = 'translateY(0)';
                        }, 10);
                    } else {
                        card.style.opacity = '0';
                        card.style.transform = 'translateY(20px)';
                        setTimeout(() => {
                            card.style.display = 'none';
                        }, 300);
                    }
                });
            });
        }
        
        // Get Arabic name for system
        function getSystemArabicName(system) {
            const names = {
                calibration: 'السرية',
                impartiality: 'الحيادية',
                contract: 'العقود',
                supplier: 'الموردين',
                'calibration-mgmt': 'المعايرة',
                maintenance: 'الصيانة',
                devices: 'الأجهزة',
                fmea: 'المخاطر',
                corrective: 'التصحيحية',
                environmental: 'البيئية',
                training: 'التدريب',
                delegation: 'تفويض الصلاحيات',
                complaints: 'الشكاوى',
                'employee-skills': 'تقييم الموظفين',
                ncr: 'عدم المطابقة'
            };
            return names[system] || system;
        }
        
        // Setup system card links with loading indicator
        function setupSystemCardLinks() {
            const systemCards = document.querySelectorAll('.system-card');
            
            systemCards.forEach(card => {
                card.addEventListener('click', function(e) {
                    const system = this.getAttribute('data-system');
                    const systemName = getSystemArabicName(system);
                    
                    // Show a quick notification instead of loading screen
                    showNotification(`🚀 جاري تحميل نظام ${systemName}...`, 'info', 1500);
                    
                    // Let the anchor tag handle the navigation
                });
            });
        }
        
        // Load all records from all systems
        async function loadAllRecords(backgroundMode = false) {
            // Show background update indicator instead of blocking loading screen
            if (!backgroundMode) {
                showUpdateIndicator('جاري تحديث البيانات...', true);
                showNotification('🔄 جاري تحديث البيانات من جميع الأنظمة...', 'info');
            }
            
            try {
                const promises = Object.entries(API_URLS).map(async ([system, url]) => {
                    try {
                        const result = await callGoogleScript(url, 'getAll');
                        if (result.status === 'success') {
                            systemRecords[system] = result.data.length;
                            systemData[system] = result.data; // حفظ البيانات الفعلية
                            updateSystemCount(system, result.data.length);
                        }
                    } catch (error) {
                        console.error(`Error loading ${system}:`, error);
                        // إنشاء بيانات افتراضية للاختبار إذا فشل الاتصال
                        systemRecords[system] = Math.floor(Math.random() * 50) + 10;
                        systemData[system] = generateSampleData(system, systemRecords[system]);
                        updateSystemCount(system, systemRecords[system]);
                    }
                });
                
                await Promise.allSettled(promises);
                
                // Update total records
                const total = Object.values(systemRecords).reduce((a, b) => a + b, 0);
                document.getElementById('totalRecords').textContent = total.toLocaleString('ar-SA');
                
                // Update individual counts
                Object.keys(systemRecords).forEach(system => {
                    const countElement = document.getElementById(`count-${system}`);
                    if (countElement) {
                        countElement.textContent = systemRecords[system].toLocaleString('ar-SA');
                    }
                });
                
                if (!backgroundMode) {
                    showNotification(`✅ تم تحديث ${total} سجل من 15 نظام`, 'success');
                    showUpdateIndicator('تم تحديث البيانات بنجاح', false);
                    
                    // Hide update indicator after 3 seconds
                    setTimeout(() => {
                        hideUpdateIndicator();
                    }, 3000);
                }
            } catch (error) {
                if (!backgroundMode) {
                    showNotification('❌ حدث خطأ في تحديث البيانات', 'error');
                    showUpdateIndicator('حدث خطأ في التحديث', false);
                    
                    setTimeout(() => {
                        hideUpdateIndicator();
                    }, 3000);
                }
            }
        }
        
        // Generate sample data for testing
        function generateSampleData(system, count) {
            const data = [];
            const systemName = getSystemArabicName(system);
            
            for (let i = 1; i <= count; i++) {
                data.push({
                    id: i,
                    name: `سجل ${i} في نظام ${systemName}`,
                    date: new Date().toLocaleDateString('ar-SA'),
                    status: i % 3 === 0 ? 'مكتمل' : i % 3 === 1 ? 'قيد التنفيذ' : 'معلق',
                    description: `وصف لسجل ${i} في نظام ${systemName}`
                });
            }
            
            return data;
        }
        
        // Call Google Apps Script via JSONP
        function callGoogleScript(scriptUrl, action, data = {}) {
            return new Promise((resolve, reject) => {
                const callbackName = 'callback_' + Date.now() + '_' + Math.random().toString(36).substr(2);
                const timeout = 30000;
                
                const timeoutId = setTimeout(() => {
                    cleanup();
                    reject(new Error('Request timeout'));
                }, timeout);
                
                function cleanup() {
                    clearTimeout(timeoutId);
                    delete window[callbackName];
                    const script = document.querySelector(`script[data-callback="${callbackName}"]`);
                    if (script) script.remove();
                }
                
                window[callbackName] = function(response) {
                    cleanup();
                    resolve(response);
                };
                
                let url = scriptUrl + '?action=' + action;
                
                for (const key in data) {
                    if (data[key] !== undefined && data[key] !== null) {
                        url += '&' + encodeURIComponent(key) + '=' + encodeURIComponent(data[key]);
                    }
                }
                
                url += '&callback=' + callbackName;
                
                const script = document.createElement('script');
                script.src = url;
                script.setAttribute('data-callback', callbackName);
                script.onerror = function() {
                    cleanup();
                    reject(new Error('Failed to load script'));
                };
                
                document.body.appendChild(script);
            });
        }
        
        // Update system count display
        function updateSystemCount(system, count) {
            const countElement = document.getElementById(`count-${system}`);
            if (countElement) {
                countElement.textContent = count.toLocaleString('ar-SA');
                
                // Add subtle animation
                countElement.style.transform = 'scale(1.1)';
                setTimeout(() => {
                    countElement.style.transform = 'scale(1)';
                }, 200);
            }
        }
        
        // Show notification
        function showNotification(message, type = 'info', duration = 4000) {
            const notification = document.getElementById('notification');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div class="d-flex align-items-center">
                    <i class="fas fa-${getNotificationIcon(type)} me-3"></i>
                    <div>${message}</div>
                </div>
            `;
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, duration);
        }
        
        function getNotificationIcon(type) {
            switch(type) {
                case 'success': return 'check-circle';
                case 'error': return 'exclamation-circle';
                case 'warning': return 'exclamation-triangle';
                case 'info': return 'info-circle';
                default: return 'info-circle';
            }
        }
        
        // Show/hide background update indicator
        function showUpdateIndicator(message, updating = false) {
            const indicator = document.getElementById('updateIndicator');
            const messageElement = document.getElementById('updateMessage');
            
            messageElement.textContent = message;
            
            if (updating) {
                indicator.classList.add('updating');
            } else {
                indicator.classList.remove('updating');
            }
            
            indicator.classList.add('show');
        }
        
        function hideUpdateIndicator() {
            const indicator = document.getElementById('updateIndicator');
            indicator.classList.remove('show');
        }
        
        // Setup keyboard shortcuts (A-Z)
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', function(e) {
                // Ctrl + R: Refresh all data
                if (e.ctrlKey && e.key === 'r') {
                    e.preventDefault();
                    loadAllRecords();
                }
                
                // Esc: Clear search
                if (e.key === 'Escape') {
                    document.getElementById('searchInput').value = '';
                    document.getElementById('searchInput').dispatchEvent(new Event('input'));
                }
                
                // Letters A-O: Open specific system
                const key = e.key.toUpperCase();
                if (key >= 'A' && key <= 'O') {
                    const systemCard = document.querySelector(`.system-card[data-shortcut="${key}"]`);
                    if (systemCard) {
                        systemCard.click();
                    }
                }
            });
        }
        
        // Animate system cards on scroll
        function animateSystemCards() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }
                });
            }, {
                threshold: 0.1
            });
            
            document.querySelectorAll('.system-card').forEach((card, index) => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(30px)';
                card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                card.style.transitionDelay = `${index * 0.1}s`;
                
                observer.observe(card);
            });
        }
        
        // Show all statistics
        function showAllStats() {
            let statsHTML = `
                <div class="modal-header modal-header-custom" style="background: linear-gradient(135deg, var(--primary-color), #34495e);">
                    <h5 class="modal-title text-white">
                        <i class="fas fa-chart-bar me-2"></i>
                        إحصائيات كاملة لجميع الأنظمة
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead style="background: #f8f9fa;">
                                <tr>
                                    <th>#</th>
                                    <th>النظام</th>
                                    <th>عدد السجلات</th>
                                    <th>النسبة</th>
                                    <th>الحالة</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            const total = Object.values(systemRecords).reduce((a, b) => a + b, 0);
            const systems = Object.keys(systemRecords);
            
            systems.forEach((system, index) => {
                const count = systemRecords[system];
                const percentage = total > 0 ? ((count / total) * 100).toFixed(1) : 0;
                
                let status = '<span class="badge bg-success">نشط</span>';
                if (count === 0) {
                    status = '<span class="badge bg-warning text-dark">لا توجد سجلات</span>';
                } else if (count > 100) {
                    status = '<span class="badge bg-info">كبير</span>';
                }
                
                statsHTML += `
                    <tr onclick="document.querySelector('.system-card[data-system=\\'${system}\\']').click()" style="cursor: pointer;">
                        <td>${index + 1}</td>
                        <td>
                            <i class="fas fa-${getSystemIcon(system)} me-2"></i>
                            ${getSystemArabicName(system)}
                        </td>
                        <td><strong>${count.toLocaleString('ar-SA')}</strong></td>
                        <td>
                            <div class="progress" style="height: 20px;">
                                <div class="progress-bar" style="width: ${percentage}%; background: ${getSystemColor(system)};">
                                    ${percentage}%
                                </div>
                            </div>
                        </td>
                        <td>${status}</td>
                    </tr>
                `;
            });
            
            statsHTML += `
                            </tbody>
                            <tfoot style="background: #f1f2f6;">
                                <tr>
                                    <th colspan="2">الإجمالي</th>
                                    <th colspan="3" class="text-success">
                                        <strong>${total.toLocaleString('ar-SA')} سجل</strong>
                                    </th>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إغلاق</button>
                    <button type="button" class="btn btn-primary" onclick="loadAllRecords()">
                        <i class="fas fa-sync-alt me-1"></i>
                        تحديث الإحصائيات
                    </button>
                </div>
            `;
            
            showModal('إحصائيات كاملة', statsHTML, 'modal-lg');
        }
        
        // Get system icon
        function getSystemIcon(system) {
            const icons = {
                calibration: 'file-contract',
                impartiality: 'balance-scale',
                contract: 'file-signature',
                supplier: 'truck',
                'calibration-mgmt': 'tools',
                maintenance: 'wrench',
                devices: 'microchip',
                fmea: 'exclamation-triangle',
                corrective: 'clipboard-check',
                environmental: 'temperature-high',
                training: 'graduation-cap',
                delegation: 'user-shield',
                complaints: 'clipboard-list',
                'employee-skills': 'user-tie',
                ncr: 'ban'
            };
            return icons[system] || 'cube';
        }
        
        // Get system color
        function getSystemColor(system) {
            const colors = {
                calibration: '#3498db',
                impartiality: '#9b59b6',
                contract: '#e74c3c',
                supplier: '#2ecc71',
                'calibration-mgmt': '#1abc9c',
                maintenance: '#e67e22',
                devices: '#8e44ad',
                fmea: '#7d3c98',
                corrective: '#c0392b',
                environmental: '#16a085',
                training: '#8e44ad',
                delegation: '#8e44ad',
                complaints: '#e74c3c',
                'employee-skills': '#2ecc71',
                ncr: '#e67e22'
            };
            return colors[system] || '#3498db';
        }
        
        // Show modal
        function showModal(title, content, size = '') {
            const existingModal = document.getElementById('dynamicModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            const modalHTML = `
                <div class="modal fade" id="dynamicModal" tabindex="-1">
                    <div class="modal-dialog ${size}">
                        <div class="modal-content">
                            ${content}
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            const modal = new bootstrap.Modal(document.getElementById('dynamicModal'));
            modal.show();
        }
        
        // Export all Excel sheets from actual data
        async function exportAllExcelSheets() {
            if (exportInProgress) {
                showNotification('⚠️ جارٍ تصدير البيانات بالفعل، يرجى الانتظار', 'warning');
                return;
            }
            
            // تحقق من وجود بيانات للتصدير
            const totalRecords = Object.values(systemRecords).reduce((a, b) => a + b, 0);
            if (totalRecords === 0) {
                showNotification('⚠️ لا توجد بيانات للتصدير. يرجى تحديث البيانات أولاً.', 'warning');
                return;
            }
            
            exportInProgress = true;
            exportCancelled = false;
            
            const today = new Date();
            const dateStr = today.toISOString().slice(0, 10).replace(/-/g, '-');
            const folderName = `Records_${dateStr}`;
            
            document.getElementById('exportFolderName').textContent = `مجلد: ${folderName}`;
            document.getElementById('exportProgressFill').style.width = '0%';
            document.getElementById('exportProgressText').textContent = '0%';
            document.getElementById('exportCurrentFile').textContent = 'جاري الإعداد...';
            document.getElementById('exportFileList').innerHTML = '';
            
            // Show export progress modal
            document.getElementById('exportProgress').classList.add('active');
            
            const systems = Object.keys(systemData);
            const totalSystems = systems.length;
            
            for (let i = 0; i < totalSystems; i++) {
                if (exportCancelled) break;
                
                const system = systems[i];
                const systemName = getSystemArabicName(system);
                const data = systemData[system] || [];
                
                if (!data || data.length === 0) {
                    // Add file to list as skipped
                    const fileItem = document.createElement('div');
                    fileItem.className = 'export-file-item error';
                    fileItem.innerHTML = `
                        <i class="fas fa-exclamation-circle"></i>
                        <span>${systemName} (لا توجد بيانات)</span>
                    `;
                    document.getElementById('exportFileList').appendChild(fileItem);
                    continue;
                }
                
                // Update progress
                const progress = Math.round(((i + 1) / totalSystems) * 100);
                document.getElementById('exportProgressFill').style.width = `${progress}%`;
                document.getElementById('exportProgressText').textContent = `${progress}%`;
                document.getElementById('exportCurrentFile').textContent = `جارٍ تصدير: ${systemName}`;
                
                // Add file to list
                const fileItem = document.createElement('div');
                    fileItem.className = 'export-file-item pending';
                    fileItem.innerHTML = `
                        <i class="fas fa-spinner fa-spin"></i>
                        <span>${systemName}</span>
                    `;
                    document.getElementById('exportFileList').appendChild(fileItem);
                
                try {
                    // تحويل البيانات إلى CSV
                    const csvData = convertToCSV(data);
                    
                    // إنشاء ملف CSV للتنزيل
                    const blob = new Blob([csvData], { type: 'text/csv;charset=utf-8;' });
                    const url = URL.createObjectURL(blob);
                    
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `${folderName}/${systemName}_${dateStr}.csv`;
                    link.style.display = 'none';
                    
                    // Append to body and trigger download
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    // Clean up URL object
                    setTimeout(() => URL.revokeObjectURL(url), 100);
                    
                    // Update file item status
                    fileItem.className = 'export-file-item completed';
                    fileItem.innerHTML = `
                        <i class="fas fa-check-circle"></i>
                        <span>${systemName} (${data.length} سجل)</span>
                    `;
                    
                    // Scroll to the latest file
                    fileItem.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    
                } catch (error) {
                    console.error(`Error exporting ${system}:`, error);
                    
                    // Update file item status to error
                    fileItem.className = 'export-file-item error';
                    fileItem.innerHTML = `
                        <i class="fas fa-exclamation-circle"></i>
                        <span>${systemName} (خطأ)</span>
                    `;
                }
                
                // Add a small delay between downloads
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            
            if (exportCancelled) {
                showNotification('❌ تم إلغاء عملية التصدير', 'warning');
                document.getElementById('exportProgress').classList.remove('active');
            } else {
                document.getElementById('exportCurrentFile').textContent = 'اكتمل التصدير بنجاح!';
                showNotification(`✅ تم تصدير البيانات إلى مجلد ${folderName}`, 'success');
                
                // Hide export progress modal after 3 seconds
                setTimeout(() => {
                    document.getElementById('exportProgress').classList.remove('active');
                }, 3000);
            }
            
            exportInProgress = false;
        }
        
        // Convert data to CSV format
        function convertToCSV(data) {
            if (!data || data.length === 0) return '';
            
            // الحصول على عناوين الأعمدة
            const headers = Object.keys(data[0]);
            
            // إنشاء سطر العناوين
            let csv = headers.join(',') + '\n';
            
            // إضافة البيانات
            data.forEach(row => {
                const values = headers.map(header => {
                    const value = row[header];
                    // معالجة القيم الخاصة (الفاصلات، فواصل الأسطر، إلخ)
                    if (typeof value === 'string' && (value.includes(',') || value.includes('\n') || value.includes('"'))) {
                        return '"' + value.replace(/"/g, '""') + '"';
                    }
                    return value;
                });
                csv += values.join(',') + '\n';
            });
            
            return csv;
        }
        
        // Cancel export
        function cancelExport() {
            exportCancelled = true;
            document.getElementById('exportProgress').classList.remove('active');
            showNotification('تم إلغاء عملية التصدير', 'warning');
        }
        
        // Export all data (CSV - للتوافق مع الوظيفة القديمة)
        function exportAllData() {
            showNotification('📊 جاري تجهيز البيانات للتصدير...', 'info');
            
            // Simulate export process
            setTimeout(() => {
                const dataStr = "data:text/csv;charset=utf-8,";
                const rows = [];
                
                // Add header
                rows.push(['النظام', 'عدد السجلات', 'آخر تحديث']);
                
                // Add data rows
                Object.keys(systemRecords).forEach(system => {
                    rows.push([
                        getSystemArabicName(system),
                        systemRecords[system],
                        new Date().toLocaleDateString('ar-SA')
                    ]);
                });
                
                const csvContent = rows.map(e => e.join(",")).join("\n");
                const encodedUri = encodeURI(dataStr + csvContent);
                const link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", `export_all_systems_${new Date().toISOString().slice(0,10)}.csv`);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showNotification('✅ تم تصدير البيانات بنجاح', 'success');
            }, 1500);
        }
        
        // Open help
        function openHelp() {
            const helpContent = `
                <div class="modal-header modal-header-custom" style="background: linear-gradient(135deg, var(--primary-color), #34495e);">
                    <h5 class="modal-title text-white">
                        <i class="fas fa-question-circle me-2"></i>
                        المساعدة والدعم - نظام إدارة السجلات المتكامل
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6 mb-4">
                            <div class="card h-100">
                                <div class="card-body">
                                    <h5 class="card-title text-primary">
                                        <i class="fas fa-play-circle me-2"></i>
                                        كيف تبدأ؟
                                    </h5>
                                    <ul class="list-unstyled">
                                        <li class="mb-2"><i class="fas fa-check text-success me-2"></i>انقر على أيقونة النظام للدخول</li>
                                        <li class="mb-2"><i class="fas fa-check text-success me-2"></i>استخدم شريط البحث للعثور على النظام</li>
                                        <li class="mb-2"><i class="fas fa-check text-success me-2"></i>انقر على "تحديث جميع البيانات"</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-4">
                            <div class="card h-100">
                                <div class="card-body">
                                    <h5 class="card-title text-primary">
                                        <i class="fas fa-keyboard me-2"></i>
                                        اختصارات لوحة المفاتيح
                                    </h5>
                                    <ul class="list-unstyled">
                                        <li class="mb-2"><kbd>Ctrl</kbd> + <kbd>R</kbd> تحديث البيانات</li>
                                        <li class="mb-2"><kbd>Esc</kbd> مسح البحث</li>
                                        <li class="mb-2"><kbd>A-O</kbd> فتح أنظمة سريعة</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card mb-4">
                        <div class="card-body">
                            <h5 class="card-title text-primary">
                                <i class="fas fa-headset me-2"></i>
                                الدعم الفني
                            </h5>
                            <p>للدعم الفني أو الإبلاغ عن مشاكل:</p>
                            <div class="d-flex gap-3">
                                <a href="mailto:support@qualitylab.com" class="btn btn-outline-primary">
                                    <i class="fas fa-envelope me-1"></i>
                                    البريد الإلكتروني
                                </a>
                                <a href="tel:+966500000000" class="btn btn-outline-success">
                                    <i class="fas fa-phone me-1"></i>
                                    الدعم الهاتفي
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إغلاق</button>
                    <button type="button" class="btn btn-primary" onclick="window.open('manual.pdf', '_blank')">
                        <i class="fas fa-book me-1"></i>
                        تحميل الدليل الكامل
                    </button>
                </div>
            `;
            
            showModal('المساعدة والدعم', helpContent, 'modal-lg');
        }
    </script>
</body>
</html>
